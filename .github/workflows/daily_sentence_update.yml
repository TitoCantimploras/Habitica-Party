name: æ¯æ—¥å¥å­æ›´æ–°

on:
  schedule:
    - cron: '0 9 * * *'  # æ¯å¤© UTC æ—¶é—´ 9 ç‚¹è§¦å‘
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  update_daily_sentence:
    runs-on: ubuntu-latest

    steps:
      - name: è®¾ç½® Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      - name: å®‰è£…ä¾èµ–
        run: |
          npm install axios

      - name: èŽ·å–æ¯æ—¥å¥å­å¹¶æ›´æ–° Habitica
        run: |
          const axios = require('axios');

          async function getDailySentence() {
              const response = await axios.get("https://sentence.iciba.com/?c=dailysentence&m=getTodaySentence");
              return { content: response.data.content, translation: response.data.note };
          }

          async function updateHabiticaGroup(content, translation) {
              const url = "https://habitica.com/api/v3/groups/party";
              const headers = {
                  "x-api-user": process.env.HABITICA_USER_ID,
                  "x-api-key": process.env.HABITICA_API_KEY,
                  "Content-Type": "application/json"
              };
              const description = `### ä¸€è¨€ Â· A sentence of the day ðŸŒ¹\n\n${content}\n\n${translation}\n\n#### Want to learn more about the party's purpose, rules, and other information? [Click here!](https://github.com/Delta-Water/Habitica-Party/blob/main/README.md)`;
              const data = { description };

              const response = await axios.put(url, data, { headers });
              return response.data;
          }

          (async () => {
              const { content, translation } = await getDailySentence();
              const result = await updateHabiticaGroup(content, translation);
              console.log(result);
          })();